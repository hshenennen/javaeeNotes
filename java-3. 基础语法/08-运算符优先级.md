
---

# Java 运算符优先级（Operator Precedence）

> [!info] 学习目标
> - 理解什么是运算符优先级和结合性
> - 掌握常用运算符的优先级顺序
> - 能正确预测表达式求值顺序
> - 学会使用括号提升可读性与准确性

---

## 1. 什么是运算符优先级？

当一个表达式包含多个运算符时，**优先级高的运算符先执行**。  
如果优先级相同，则根据**结合性**（从左到右或从右到左）决定顺序。

> 💡 类比数学：`3 + 4 * 2` 中，`*` 优先级高于 `+`，所以先算 `4*2=8`，再 `3+8=11`

---

## 2. Java 运算符优先级表（从高到低）

| 优先级 | 运算符 | 名称 | 结合性 | 示例 |
|--------|--------|------|--------|------|
| 1 | `()` `[]` `. ` | 括号、数组下标、成员访问 | **从左到右** | `(a + b)`, `arr[0]`, `obj.method()` |
| 2 | `++` `--` `+` `-` `!` `~` | 自增/自减、正负号、逻辑非、位非 | **从右到左** | `++x`, `-5`, `!flag` |
| 3 | `*` `/` `%` | 乘、除、取模 | **从左到右** | `a * b / c` |
| 4 | `+` `-` | 加、减、字符串拼接 | **从左到右** | `a + b - c` |
| 5 | `<<` `>>` `>>>` | 位移运算符 | **从左到右** | `x << 2` |
| 6 | `<` `<=` `>` `>=` `instanceof` | 关系/类型比较 | **从左到右** | `a < b`, `obj instanceof String` |
| 7 | `==` `!=` | 相等性比较 | **从左到右** | `a == b` |
| 8 | `&` | 位与 / 逻辑与（非短路） | **从左到右** | `a & b` |
| 9 | `^` | 位异或 / 逻辑异或 | **从左到右** | `a ^ b` |
| 10 | `\|` | 位或 / 逻辑或（非短路） | **从左到右** | `a \| b` |
| 11 | `&&` | 逻辑与（**短路**） | **从左到右** | `a && b` |
| 12 | `\|\|` | 逻辑或（**短路**） | **从左到右** | `a \|\| b` |
| 13 | `? :` | 三元条件运算符 | **从右到左** | `cond ? a : b` |
| 14 | `=`, `+=`, `-=`, `*=`, `/=`, `%=`, `&=`, `\|=`, `^=`, `<<=`, `>>=` | 赋值运算符 | **从右到左** | `a = b = 5` |
| 15 | `->` | Lambda 表达式 | — | `x -> x * 2` |

> ✅ **初学者重点掌握前 7 行 + 逻辑运算符（11~12）+ 赋值（14）**

---

## 3. 结合性（Associativity）

- **从左到右**：`a - b - c` → `(a - b) - c`
- **从右到左**：`a = b = 5` → `a = (b = 5)`

### 🌰 示例：结合性影响结果
```java
int a = 10, b = 5, c = 2;
int result = a / b / c; // (10 / 5) / 2 = 2 / 2 = 1

// 赋值是右结合
int x, y, z;
x = y = z = 100; // 等价于 x = (y = (z = 100))
```

---

## 4. 常见易错表达式分析

### ❌ 误区 1：自增与优先级
```java
int i = 1;
int j = i++ + ++i; 
// 执行顺序：
// 1. i++ → 返回 1，i 变为 2
// 2. ++i → i 变为 3，返回 3
// 3. j = 1 + 3 = 4
System.out.println("i=" + i + ", j=" + j); // i=3, j=4
```

### ❌ 误区 2：赋值 vs 比较
```java
int a = 5;
// if (a = 3) { ... } // 编译错误！因为 a=3 是 int，不是 boolean
// 正确应为：if (a == 3)
```

### ❌ 误区 3：逻辑运算符优先级
```java
boolean flag = true;
int x = 0;
// 下面代码安全吗？
if (flag && x != 0 && 10 / x > 1) { ... } // ✅ 安全！短路避免除零

// 但如果写成：
if (x != 0 & 10 / x > 1) { ... } // ❌ 危险！& 不短路，会除零异常
```

---

## 5. 最佳实践：用括号明确意图

即使你知道优先级，**加括号能让代码更清晰、更安全**！

```java
// 不推荐：依赖记忆优先级
if (a == b && c > d || e < f) { ... }

// 推荐：用括号分组逻辑
if ((a == b && c > d) || (e < f)) { ... }
```

> 💡 **黄金法则**：**可读性 > 炫技**。让别人（或未来的你）一眼看懂逻辑！

---

## 6. 小测验

判断以下表达式的计算结果：

1. `3 + 4 * 2 / (1 - 5)`  
2. `true ? false : true ? false : true`  
3. `int a = 5; int b = a += 3 * 2;` → `b` 的值是？

<details>
<summary>✅ 答案</summary>

1. `3 + 4 * 2 / (1 - 5)`  
   → `3 + 8 / (-4)`  
   → `3 + (-2)`  
   → **1**

2. 三元运算符**右结合**：  
   `true ? false : (true ? false : true)`  
   → 因为第一个条件为 `true`，直接返回 `false`  
   → **false**

3. `a += 3 * 2` → `a = a + (3 * 2) = 5 + 6 = 11`，所以 `b = 11`  
   → **b = 11**
</details>

---

## 7. 总结口诀（初学者记忆）

> 🧠 **“括号最高，自增靠前，乘除先于加减，比较在中间，逻辑往后站，赋值最后干。”**

---
